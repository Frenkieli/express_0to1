module.exports=function(e){var r={};function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var o in e)t.d(n,o,function(r){return e[r]}.bind(null,o));return n},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s=10)}([function(e,r,t){"use strict";var n=t(1),o=t.n(n);t(12).config();const s=o.a.object().keys({NODE_ENV:o.a.string().default("development").allow(["development","production"]),PORT:o.a.number().default(8080),MYSQL_PORT:o.a.number().default(3306),MYSQL_HOST:o.a.string().default("127.0.0.1"),MYSQL_USER:o.a.string(),MYSQL_PASS:o.a.string(),MYSQL_NAME:o.a.string(),VERSION:o.a.string()}).unknown().required(),{error:a,value:i}=o.a.validate(process.env,s);if(a)throw new Error(`Config validation error: ${a.message}`);const c={version:i.VERSION,env:i.NODE_ENV,port:i.PORT,mysqlPort:i.MYSQL_PORT,mysqlHost:i.MYSQL_HOST,mysqlUserName:i.MYSQL_USER,mysqlPass:i.MYSQL_PASS,mysqlDatabase:i.MYSQL_DATABASE};r.a=c},function(e,r){e.exports=require("joi")},function(e,r){e.exports=require("express")},function(e,r){e.exports=require("mysql")},function(e,r){e.exports=require("express-validation")},function(e,r){e.exports=require("body-parser")},function(e,r,t){"use strict";var n=t(2),o=t.n(n),s=t(0),a=t(3),i=t.n(a),c=t(4),u=t.n(c);const l=i.a.createPool({connectionLimit:10,host:s.a.mysqlHost,user:s.a.mysqlUserName,password:s.a.mysqlPass,database:s.a.mysqlDatabase});var d=()=>new Promise((e,r)=>{l.getConnection((t,n)=>{t?r(t):n.query("SELECT\n            *\n          FROM\n            Article",(t,o)=>{t?(console.error("SQL error: ",t),r(t)):e(o),n.release()})})}),m=e=>new Promise((r,t)=>{l.getConnection((n,o)=>{n?t(n):o.query("INSERT INTO Article SET ?",e,(e,n)=>{e?(console.error("SQL error: ",e),t(e)):1===n.affectedRows&&r(`新增成功！ article_id: ${n.insertId}`),o.release()})})}),p=(e,r)=>new Promise((t,n)=>{l.getConnection((o,s)=>{o?n(o):s.query("UPDATE Article SET ? WHERE article_id = ?",[e,r],(e,r)=>{e?(console.error("SQL error: ",e),n(e)):0===r.affectedRows?t("請確認修改Id！"):r.message.match("Changed: 1")?t("資料修改成功"):t("資料無異動"),s.release()})})}),f=e=>new Promise((r,t)=>{l.getConnection((n,o)=>{n?t(n):o.query("DELETE FROM Article WHERE article_id = ?",e,(e,n)=>{e?(console.error("SQL error: ",e),t(e)):1===n.affectedRows?r("刪除成功！"):r("刪除失敗！"),o.release()})})});var y=(e,r)=>{d().then(e=>{r.send(e)}).catch(e=>r.send(e))},g=(e,r)=>{const t=e.body;m(t).then(e=>{r.send(e)}).catch(e=>r.send(e))},_=(e,r)=>{const t=e.params.article_id,n=e.body;p(n,t).then(e=>{r.send(e)}).catch(e=>r.send(e))},b=(e,r)=>{const t=e.params.article_id;f(t).then(e=>{r.send(e)}).catch(e=>r.send(e))},q=t(1),S=t.n(q),E={createArticle:{body:{user_id:S.a.number().required(),article_title:S.a.string().required(),article_tag:S.a.string().required(),article_content:S.a.string().min(20).required()}},createUser:{body:{user_name:S.a.string().required(),user_mail:S.a.string().email().trim().required(),user_password:S.a.string().regex(/[a-zA-Z0-9]{6,30}$/).required()}}};const h=o.a.Router();h.route("/").get(y).post(u()(E.createArticle),g),h.route("/:article_id").put(_).delete(b);var P=h,v=t(7),w=t.n(v);const O=i.a.createPool({connectionLimit:10,host:s.a.mysqlHost,user:s.a.mysqlUserName,password:s.a.mysqlPass,database:s.a.mysqlDatabase});var R=e=>new Promise((r,t)=>{O.getConnection((n,o)=>{n?t(n):o.query("INSERT INTO User SET ?",e,(e,n)=>{e?(console.error("SQL error: ",e),t(e)):1===n.affectedRows&&r(`新增成功！ user_id: ${n.insertId}`),o.release()})})}),L=()=>new Promise((e,r)=>{O.getConnection((t,n)=>{t?r(t):n.query("SELECT\n            *\n          FROM\n            User",(t,o)=>{t?(console.error("SQL error: ",t),r(t)):e(o),n.release()})})}),T=(e,r)=>new Promise((t,n)=>{O.getConnection((o,s)=>{o?n(o):s.query("UPDATE User SET ? WHERE user_id = ?",[e,r],(e,r)=>{e?(console.error("SQL error: ",e),n(e)):0===r.affectedRows?t("請確認修改Id！"):r.message.match("Changed: 1")?t("資料修改成功"):t("資料無異動"),s.release()})})}),x=e=>new Promise((r,t)=>{O.getConnection((n,o)=>{n?t(n):o.query("DELETE FROM User WHERE user_id = ?",e,(e,n)=>{e?(console.error("SQL error: ",e),t(e)):1===n.affectedRows?r("刪除成功！"):r("刪除失敗！"),o.release()})})}),M=e=>new Promise((r,t)=>{O.getConnection((n,o)=>{n?t(n):o.query("SELECT * FROM User WHERE user_mail = ?",e.user_mail,(n,s)=>{if(n)console.error("SQL error: ",n),t(n);else if(0===Object.keys(s).length)r("信箱尚未註冊！");else{const t=s[0].user_password,n=e.user_password;w.a.compare(n,t).then(e=>{r(e?"登入成功":"您輸入的密碼有誤！")})}o.release()})})});var Q=(e,r)=>{const t={user_name:e.body.user_name,user_mail:e.body.user_mail,user_password:w.a.hashSync(e.body.user_password,10)};R(t).then(e=>{r.send(e)}).catch(e=>r.send(e))},C=(e,r)=>{L().then(e=>{r.send(e)}).catch(e=>r.send(e))},j=(e,r)=>{const t=e.params.user_id,n=e.body;T(n,t).then(e=>{r.send(e)}).catch(e=>r.send(e))},A=(e,r)=>{const t=e.params.user_id;x(t).then(e=>{r.send(e)}).catch(e=>r.send(e))},N=(e,r)=>{const t=e.body;M(t).then(e=>{r.send(e)}).catch(e=>r.send(e))};const U=o.a.Router();U.route("/").get(C).post(u()(E.createUser),Q),U.route("/:user_id").put(j).delete(A),U.route("/login").post(N);var D=U;const H=o.a.Router();H.get("/",(e,r)=>{r.send(`此路徑是: localhost:${s.a.port}/api`)}),H.get("/sqlTest",(e,r)=>{i.a.createPool({connectionLimit:10,host:s.a.mysqlHost,user:s.a.mysqlUserName,password:s.a.mysqlPass,database:s.a.mysqlDatabase}).getConnection((e,t)=>{e?(r.send(e),console.log("連線失敗！")):(r.send("連線成功！"),console.log(t))})}),H.use("/article",P),H.use("/user",D);var I=H,Y=t(5),$=t.n(Y),k=t(8),F=t.n(k),W=t(9),V=t.n(W);const z=o()();z.use($.a.json()),z.use($.a.urlencoded({extended:!0})),z.use(F()()),z.use(V()("dev")),z.get("/",(e,r)=>{r.send(`server started on  port http://127.0.0.1:${s.a.port} (${s.a.env})`)}),z.use("/api",I);r.a=z},function(e,r){e.exports=require("bcrypt")},function(e,r){e.exports=require("cors")},function(e,r){e.exports=require("morgan")},function(e,r,t){"use strict";t.r(r),function(e){var n=t(0),o=t(6);e.parent||o.a.listen(n.a.port,()=>{console.log(`server started on  port http://127.0.0.1:${n.a.port} (${n.a.env})`)}),r.default=o.a}.call(this,t(11)(e))},function(e,r){e.exports=function(e){if(!e.webpackPolyfill){var r=Object.create(e);r.children||(r.children=[]),Object.defineProperty(r,"loaded",{enumerable:!0,get:function(){return r.l}}),Object.defineProperty(r,"id",{enumerable:!0,get:function(){return r.i}}),Object.defineProperty(r,"exports",{enumerable:!0}),r.webpackPolyfill=1}return r}},function(e,r){e.exports=require("dotenv")}]);